import React, { createContext, useReducer, useEffect } from 'react'; export const CartContext = createContext(); function reducer(state, action){ switch(action.type){ case 'init': return action.payload || []; case 'add': { const ex = state.find(i=>i.id===action.item.id); if(ex) return state.map(i=>i.id===action.item.id?{...i,qty:i.qty+1}:i); return [...state,{...action.item,qty:1}]; } case 'update': return state.map(i=> i.id===action.id?{...i,qty:action.qty}:i).filter(i=>i.qty>0); case 'remove': return state.filter(i=>i.id!==action.id); case 'clear': return []; default: return state;} } export function CartProvider({children}){ const [cart, dispatch] = useReducer(reducer, []); useEffect(()=>{ const s = localStorage.getItem('cart_v2'); if(s) dispatch({type:'init', payload: JSON.parse(s)}); }, []); useEffect(()=>localStorage.setItem('cart_v2', JSON.stringify(cart)), [cart]); return <CartContext.Provider value={{cart,dispatch}}>{children}</CartContext.Provider>; }